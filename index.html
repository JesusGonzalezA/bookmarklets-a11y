<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="dark" />
    <title>Bookmarklets para Accesibilidad</title>
    <style>
      * { font-family: Verdana, sans-serif; background: #1a1a1a; color: #ffffff; }
      body { padding: 1.25rem; max-width: 50rem; margin: 1.25rem auto; }
      h1 { padding: 1rem; }
      .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
      
      .search-container { padding: 1rem; border: 1px solid #333; border-radius: 0.5rem; background: #1e1e1e; margin-bottom: 1.25rem; margin-top: 1.25rem; }
      .search-container label { display: block; margin-bottom: 0.5rem; font-weight: bold; color: #ffffff; }
      input { padding: 0.5rem; width: 100%; max-width: 18.75rem; border: 1px solid #555; border-radius: 0.25rem; background: #2a2a2a; color: #ffffff; margin-bottom: 0.625rem; }
      input::placeholder { color: #cccccc; }

      li { margin-bottom: 1.25rem; padding: 0.625rem; border: 1px solid #333; border-radius: 0.3125rem; background: #1e1e1e; }
      
      .actions { display: flex; }
      button { padding: 0.5rem 0.75rem; background: #0066cc; color: white; border: 2px solid #004499; border-radius: 0.1875rem; cursor: pointer; margin-right: 0.5rem; }
      button:hover { background: #004499; }
      a { padding: 0.5rem 0.75rem; background: #28a745; color: white; text-decoration: none; border: 2px solid #218838; border-radius: 0.1875rem; cursor: pointer; }
      a:hover { background: #218838; }

      details { border: 1px solid #333; border-radius: 0.3125rem; padding: 0.625rem; background: #1e1e1e; margin-bottom: 1.25rem; }
      summary { cursor: pointer; font-weight: bold; }
    </style>
    <style>
      @media (max-width: 600px) {
        body { padding: 1rem; }
        .search-container { padding: 0.75rem; }
        li { padding: 0.5rem; }
        details { padding: 0.5rem; }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Bookmarklets para Accesibilidad</h1>
    </header>

    <main>

    <section>
      <details>
        <summary>Instrucciones para añadir Bookmarklets</summary>
        <p>Los bookmarklets son pequeños scripts de JavaScript que puedes guardar como marcadores en tu navegador para ejecutar funciones de accesibilidad en cualquier página web.</p>
        <ol>
          <li>Copia el código del bookmarklet</li>
          <li>Añade un nuevo marcador y usa el código copiado como dirección de enlace</li>
        </ol>
      </details>
    </section>

    <section>
      <h2>Lista de Bookmarklets</h2>

      <label for="filter-input">Filtrar bookmarklets</label>
      <input id="filter-input" type="search" placeholder="Buscar por nombre o descripción..." autocomplete="off">

      <div id="result-count" aria-live="polite" aria-atomic="true" class="sr-only"></div>
      <ol id="bookmarklet-list">
        <!-- Los elementos se generarán dinámicamente con JavaScript -->
      </ol>
    </section>

    <script>
      const bookmarklets = [
        { name: 'a11y-tools', desc: 'Herramientas de accesibilidad en un mismo sitio' },
        { name: 'reduced-motion', desc: 'Detecta si hay animaciones activas a pesar de utilizar preferencias de animaciones reducidas.'},
        { name: 'autoplay-video', desc: 'Detecta si hay vídeos reproduciéndose.' }
      ];

      const list = document.getElementById('bookmarklet-list');
      const filterInput = document.getElementById('filter-input');

      function updateResultCount() {
        const count = list.children.length;
        const resultCountDiv = document.getElementById('result-count');
        resultCountDiv.textContent = `Mostrando ${count} resultado${count !== 1 ? 's' : ''}`;
      }

      function renderList(filter = '') {
        list.innerHTML = '';
        bookmarklets.forEach(bookmarklet => {
          if (filter && !bookmarklet.name.toLowerCase().includes(filter.toLowerCase()) && !bookmarklet.desc.toLowerCase().includes(filter.toLowerCase())) {
            return;
          }
          const li = document.createElement('li');
          li.setAttribute('data-name', bookmarklet.name);
          li.innerHTML = `
            <h3>${bookmarklet.name.replace('-', ' ').toUpperCase()}</h3>
            <p>${bookmarklet.desc}</p>
            <div class="actions">
              <button type="button" aria-label="Copiar código del bookmarklet ${bookmarklet.name}">Copiar código</button>
              <a href="#" id="install-${bookmarklet.name}" aria-label="Usar bookmarklet ${bookmarklet.name}">Usar</a>
            </div>
          `;
          const button = li.querySelector('button');
          button.addEventListener('click', () => {
            fetch(`dist/${bookmarklet.name}.js`)
              .then(response => response.text())
              .then(code => {
                navigator.clipboard.writeText(code).then(() => {
                  alert('Código copiado al portapapeles.');
                }).catch(err => {
                  console.error('Error al copiar: ', err);
                  alert('Error al copiar. Revisa la consola.');
                });
              })
              .catch(err => {
                console.error('Error al cargar el código: ', err);
                alert('Error al cargar el código del bookmarklet.');
              });
          });

          // Set href for install link
          fetch(`dist/${bookmarklet.name}.js`)
            .then(response => response.text())
            .then(code => {
              document.getElementById(`install-${bookmarklet.name}`).href = code;
            })
            .catch(err => {
              console.error('Error al cargar el código para instalar: ', err);
            });

          list.appendChild(li);
        });
        updateResultCount();
      }

      function debounce(func, delay) {
        let timeoutId;
        return function(...args) {
          clearTimeout(timeoutId);
          timeoutId = setTimeout(() => func.apply(this, args), delay);
        };
      }

      const debouncedRender = debounce((value) => renderList(value), 300);

      renderList();

      filterInput.addEventListener('input', (e) => {
        debouncedRender(e.target.value);
      });
    </script>
  </main>
</body>
</html>
